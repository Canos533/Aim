<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Valorant Sensitivity Finder</title>
<style>
  html, body { margin:0; padding:0; height:100%; background:#111; color:white; font-family:sans-serif; }
  .arena { position:relative; width:800px; height:520px; margin:20px auto; background:linear-gradient(to top right,#2a2a3d,#1c1c2b); border:2px solid #555; border-radius:16px; overflow:hidden; user-select:none; }
  .crosshair { position:absolute; width:0; height:0; pointer-events:none; }
  .crosshair div { position:absolute; background:white; }
  .crosshair .center { width:2px; height:2px; background:#f0f; box-shadow:0 0 8px #f0f; top:-1px; left:-1px; }
  .crosshair .h { width:8px; height:2px; top:-1px; left:-4px; }
  .crosshair .v { width:2px; height:8px; top:-4px; left:-1px; }
  .target { position:absolute; border:2px solid rgba(255,255,255,0.8); background:rgba(255,255,255,0.1); border-radius:50%; }
  .controls { max-width:800px; margin:0 auto; padding:10px; }
  button { padding:6px 12px; margin-right:10px; border:none; border-radius:8px; cursor:pointer; }
  button.start { background:#4ade80; color:#111; }
  button.stop { background:#f87171; color:#111; }
  label { display:block; margin:6px 0; }
  input[type=checkbox] { margin-right:4px; }
  .warning { position:absolute; top:10px; left:10px; right:10px; background:#b91c1c; padding:8px; border-radius:8px; font-size:12px; }
</style>
</head>
<body>
<div class="controls">
  <button id="startBtn" class="start">Teste Ba≈üla</button>
  <button id="stopBtn" class="stop">Durdur</button>
  <label><input type="checkbox" id="usePointerLock" checked> Pointer Lock (varsa)</label>
</div>
<div class="arena" id="arena"></div>
<div id="warning" class="warning" style="display:none;"></div>

<script>
const arena = document.getElementById('arena');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const usePointerLockCheckbox = document.getElementById('usePointerLock');
const warningEl = document.getElementById('warning');

let cursor = {x:400,y:260};
let spawn = null;
let running = false;
let pointerLockActive = false;
let shots = [];
let targetsLeft = 0;
let currentSens = 0.4;
const roundTargets = 12;
const targetR = 18;
const arenaPadding = 24;

function clamp(v,min,max){return Math.max(min,Math.min(max,v));}

function distance(x1,y1,x2,y2){return Math.hypot(x1-x2,y1-y2);}

function createCrosshair(){ 
  const div = document.createElement('div'); 
  div.className='crosshair'; 
  div.innerHTML='<div class="h"></div><div class="v"></div><div class="center"></div>';
  arena.appendChild(div); 
  return div;
}

function createTarget(x,y,r){
  const t = document.createElement('div');
  t.className='target';
  t.style.width=t.style.height=(r*2)+'px';
  t.style.left=(x-r)+'px';
  t.style.top=(y-r)+'px';
  arena.appendChild(t);
  return t;
}

const crosshairEl = createCrosshair();
let targetEl = null;

function updateCrosshair(){ crosshairEl.style.left=cursor.x+'px'; crosshairEl.style.top=cursor.y+'px'; }

function spawnTarget(){
  const x = Math.random()*(arena.clientWidth-2*(arenaPadding+targetR)) + arenaPadding + targetR;
  const y = Math.random()*(arena.clientHeight-2*(arenaPadding+targetR)) + arenaPadding + targetR;
  spawn={x,y,r:targetR,ts:performance.now()};
  if(targetEl){arena.removeChild(targetEl);}
  targetEl=createTarget(x,y,targetR);
}

function removeTarget(){ if(targetEl){arena.removeChild(targetEl); targetEl=null;} spawn=null; }

function startTest(){
  shots=[];
  targetsLeft=roundTargets;
  running=true;
  cursor={x:arena.clientWidth/2,y:arena.clientHeight/2};
  updateCrosshair();
  warningEl.style.display='none';
}

function stopTest(){
  running=false;
  targetsLeft=0;
  removeTarget();
  try{document.exitPointerLock();}catch(e){}
}

function recordShot(hit,timeMs,missDist){ 
  shots.push({hit,timeMs,dist:missDist}); 
  targetsLeft--; 
  removeTarget(); 
  if(targetsLeft>0){setTimeout(spawnTarget,300);} 
}

function arenaClick(e){
  if(usePointerLockCheckbox.checked && 'requestPointerLock' in arena && !pointerLockActive){
    try{arena.requestPointerLock(); warningEl.style.display='none';} 
    catch(err){ warningEl.style.display='block'; warningEl.innerText='Pointer Lock engellendi, fallback mod aktif.'; }
    return;
  }
  if(!running||!spawn) return;
  const d=distance(cursor.x,cursor.y,spawn.x,spawn.y);
  recordShot(d<=spawn.r, performance.now()-spawn.ts, d<=spawn.r?0:d-spawn.r);
}

function arenaMouseMove(e){
  if(pointerLockActive) return;
  const rect=arena.getBoundingClientRect();
  cursor.x=clamp(e.clientX-rect.left,arenaPadding,arena.clientWidth-arenaPadding);
  cursor.y=clamp(e.clientY-rect.top,arenaPadding,arena.clientHeight-arenaPadding);
  updateCrosshair();
}

arena.addEventListener('click',arenaClick);
arena.addEventListener('mousemove',arenaMouseMove);

startBtn.addEventListener('click',()=>{startTest();spawnTarget();});
stopBtn.addEventListener('click',stopTest);

document.addEventListener('pointerlockchange',()=>{pointerLockActive=document.pointerLockElement===arena;});

document.addEventListener('mousemove',e=>{
  if(!pointerLockActive||!running) return;
  const scale=0.075+currentSens*0.925;
  cursor.x=clamp(cursor.x+e.movementX*scale,arenaPadding,arena.clientWidth-arenaPadding);
  cursor.y=clamp(cursor.y+e.movementY*scale,arenaPadding,arena.clientHeight-arenaPadding);
  updateCrosshair();
});
</script>
</body>
</html>
